<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="saleInfo">
	<select id="getSaleInfo" resultClass="com.godoing.rose.lang.DataMap" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT * FROM saleinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</select>
	
	<insert id="insertSaleInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		INSERT INTO saleinfo
		(user_name,imei,imsi,phone,phone_model,sys_version,province,belong_project,date_time,ip,app_version) 
		VALUES 
		(#userName#,#imei#,#imsi#,#phone#,#phoneModel#,#sysVersion#,#province#,#belongProject#,#dateTime#,#ip#,#appVersion#)
	</insert>
	
	<update id="updateSaleInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		UPDATE saleinfo 
		<dynamic prepend="SET">
			<isNotEmpty prepend="," property="imei">
		      imei=#imei#
			</isNotEmpty>
			<isNotEmpty prepend="," property="imsi">
		      imsi=#imsi#
			</isNotEmpty>
			<isNotEmpty prepend="," property="phone">
		      phone=#phone#
			</isNotEmpty>
			<isNotEmpty prepend="," property="phoneModel">
		      phone_model=#phoneModel#
			</isNotEmpty>
			<isNotEmpty prepend="," property="sysVersion">
		      sys_version=#sysVersion#
			</isNotEmpty>
			<isNotEmpty prepend="," property="province">
		      province=#province#
			</isNotEmpty>
			<isNotEmpty prepend="," property="belongProject">
		      belong_project=#belongProject#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ip">
		      ip=#ip#
			</isNotEmpty>
			<isNotEmpty prepend="," property="appVersion">
		      app_version=#appVersion#
			</isNotEmpty>
		</dynamic>  
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</update>
	
	<delete id="deleteSaleInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		DELETE FROM saleinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$ 
			</isNotEmpty>
		</dynamic>
	</delete>
	
	<select id="getSaleInfoListByVo" resultClass="com.godoing.rose.lang.DataMap" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT * FROM saleinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="order by">
			<isNotEmpty prepend="order by" property="orderBy">
				$orderBy$
			</isNotEmpty>
		</dynamic>
			limit
			<isNotEmpty prepend=" " property="from">
				$from$
			</isNotEmpty>
				,
			<isNotEmpty prepend=" " property="pageSize">
				$pageSize$
			</isNotEmpty>
	</select>
	
	<select id="getSaleInfoCount" resultClass="java.lang.Integer" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo" >
		SELECT COUNT(*) FROM saleinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getSaleInfoListGroupByProvince" resultClass="com.godoing.rose.lang.DataMap" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT COUNT(id) id,province FROM saleinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
		GROUP BY province
		<dynamic prepend="order by">
			<isNotEmpty prepend="order by" property="orderBy">
				$orderBy$
			</isNotEmpty>
		</dynamic>
			limit
			<isNotEmpty prepend=" " property="from">
				$from$
			</isNotEmpty>
				,
			<isNotEmpty prepend=" " property="pageSize">
				$pageSize$
			</isNotEmpty>
	</select>
	
	<select id="getSaleInfoCountGroupByProvince" resultClass="java.lang.Integer" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo" >
		SELECT COUNT(DISTINCT(province)) FROM saleinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getAddDayGroupByTime" resultClass="com.godoing.rose.lang.DataMap" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo" >
		SELECT * FROM device_login d LEFT JOIN appuserinfo a USING(belong_project,add_time) LEFT JOIN device_active_info USING(belong_project,add_time) LEFT JOIN userlogin USING(belong_project,add_time) LEFT JOIN device_active_history dh USING(belong_project,add_time) LEFT JOIN projectinfo p ON d.belong_project=p.id
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="order by">
			<isNotEmpty prepend="order by" property="orderBy">
				$orderBy$
			</isNotEmpty>
		</dynamic>
			limit
			<isNotEmpty prepend=" " property="from">
				$from$
			</isNotEmpty>
				,
			<isNotEmpty prepend=" " property="pageSize">
				$pageSize$
			</isNotEmpty>
	</select>
	
	<select id="getCountAddDayGroupByTime" resultClass="java.lang.Integer" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT COUNT(*) FROM device_login
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="addTime">
				$addTime$
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="getProductInfoListByVo" resultClass="com.godoing.rose.lang.DataMap" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT * FROM productinfo 
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
			</dynamic>
		<dynamic prepend="order by">
			<isNotEmpty prepend="order by" property="orderBy">
				$orderBy$
			</isNotEmpty>
		</dynamic>
				limit
				<isNotEmpty prepend=" " property="from">
				$from$
				</isNotEmpty>
				,
				<isNotEmpty prepend=" " property="pageSize">
				$pageSize$
				</isNotEmpty>
	</select>
	
	<select id="getProductInfoCount" resultClass="java.lang.Integer" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT COUNT(*) FROM productinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</select>
	
	<insert id="insertProductInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		INSERT INTO productinfo(product_name,product_type,product_intro,product_flag,date_time,product_order,icon,price,product_address) VALUES (#productName#,#productType#,#productIntro#,#productFlag#,#dateTime#,#productOrder#,#icon#,#price#,#productAddress#)
	</insert>
	
	  <select id="getMaxProductId" resultClass="java.lang.Integer" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT MAX(id_p) AS id_p FROM productinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</select>
	
	<insert id="insertPhotoInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
        INSERT INTO photoinfo(product_id,product_picture) values (#productCode#,#productPicture#)
    </insert>
    
    <select id="getProductInfo" resultClass="com.godoing.rose.lang.DataMap" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		SELECT * FROM productinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="order by">
			<isNotEmpty prepend="order by" property="orderBy">
				$orderBy$
			</isNotEmpty>
		</dynamic >
		<dynamic prepend="limit">				
				<isNotEmpty prepend=" " property="from">
				$from$
				</isNotEmpty>
				<isNotEmpty prepend=", " property="pageSize">
				$pageSize$
				</isNotEmpty>
		</dynamic>
	</select>
	<delete id="deleteProductInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		DELETE FROM productinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</delete>
	
	 <select id="getPhotoInfo" resultClass="com.godoing.rose.lang.DataMap" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
       select * from photoInfo
       <dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="order by">
			<isNotEmpty prepend="order by" property="orderBy">
				$orderBy$
			</isNotEmpty>
			</dynamic>
    </select>
    
    <delete id="deletePhotoInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		DELETE FROM photoinfo
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</delete>
	
	<update id="updateProductInfo" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo">
		UPDATE productinfo SET  product_name = #productName#  ,product_type = #productType#, product_intro = #productIntro#, product_flag = #productFlag#, product_order = #productOrder#, icon=#icon#, price=#price#, product_address=#productAddress#
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</update>
	
	<select id="getPayforInfoCount" resultClass="java.lang.Integer" parameterClass="com.wtwd.sys.saleinfo.domain.SaleInfo" >
		SELECT COUNT(p.id) FROM  payfor_info  p 
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="condition">
				$condition$
			</isNotEmpty>
		</dynamic>
	</select>
</sqlMap>